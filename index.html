<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- CRITICAL: Error catching BEFORE anything else loads -->
    <script>
      (function () {
        // Persist as early as possible using the same storage key the Diagnostics page reads.
        // This captures module-evaluation failures that can happen before React mounts.

        function safeRead(key) {
          try {
            var raw = localStorage.getItem(key);
            if (!raw) return [];
            var parsed = JSON.parse(raw);
            return Array.isArray(parsed) ? parsed : [];
          } catch (e) {
            return [];
          }
        }

        function safeWrite(key, value) {
          try {
            localStorage.setItem(key, JSON.stringify(value));
            return true;
          } catch (e) {
            return false;
          }
        }

        function persist(log) {
          try {
            window.__earlyErrors = Array.isArray(window.__earlyErrors) ? window.__earlyErrors : [];
            window.__earlyErrors.push(log);
          } catch (e) {
            // ignore
          }

          // Match EarlyErrorLogger's key so /diagnostics can show these.
          try {
            var key = 'global_error_logs_persisted';
            var existing = safeRead(key);
            existing.push(log);
            if (existing.length > 50) existing = existing.slice(existing.length - 50);
            safeWrite(key, existing);
          } catch (e) {
            // ignore
          }

          // Also keep a runtime buffer as a fallback (Diagnostics reads this too).
          try {
            window.__globalErrorLogsRuntime = Array.isArray(window.__globalErrorLogsRuntime)
              ? window.__globalErrorLogsRuntime
              : [];
            window.__globalErrorLogsRuntime.push(log);
            if (window.__globalErrorLogsRuntime.length > 50) {
              window.__globalErrorLogsRuntime = window.__globalErrorLogsRuntime.slice(
                window.__globalErrorLogsRuntime.length - 50,
              );
            }
          } catch (e) {
            // ignore
          }
        }

        window.onerror = function (msg, url, line, col, error) {
          var entry = {
            timestamp: new Date().toISOString(),
            type: 'error',
            message: String(msg),
            filename: url,
            lineno: line,
            colno: col,
            stack: error && error.stack ? error.stack : null,
            url: window.location && window.location.href ? window.location.href : undefined,
            userAgent: navigator && navigator.userAgent ? navigator.userAgent : undefined,
          };

          persist(entry);
          console.error('[EARLY ERROR]', msg, url, line, error);
          return false;
        };

        window.onunhandledrejection = function (event) {
          var reason = event && event.reason;
          var entry = {
            timestamp: new Date().toISOString(),
            type: 'unhandledrejection',
            message: reason && reason.message ? reason.message : String(reason),
            stack: reason && reason.stack ? reason.stack : null,
            url: window.location && window.location.href ? window.location.href : undefined,
            userAgent: navigator && navigator.userAgent ? navigator.userAgent : undefined,
          };

          persist(entry);
          console.error('[UNHANDLED REJECTION]', reason);
        };
      })();
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="Buy crypto with credit card or bank transfer. Fast, secure cryptocurrency purchases with low fees." />
    <meta property="og:title" content="EZOnramp - Buy Crypto Instantly" />
    <meta property="og:description" content="Fast, secure cryptocurrency purchases with credit card or bank transfer. Low fees, instant delivery." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/favicon.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="EZOnramp - Buy Crypto Instantly" />
    <meta name="twitter:description" content="Fast, secure cryptocurrency purchases with credit card or bank transfer." />
    <link rel="canonical" href="https://ezonramp.lovable.app" />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <!-- Preconnect to CDNs for faster loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FinancialService",
      "name": "EZOnramp",
      "description": "Fast, secure cryptocurrency purchases with credit card or bank transfer",
      "url": "https://ezonramp.lovable.app",
      "sameAs": [],
      "offers": {
        "@type": "Offer",
        "description": "Cryptocurrency purchase services"
      }
    }
    </script>
    <title>EZOnramp - Buy Crypto with Credit Card | Fast & Secure</title>
  </head>

  <body>
    <div id="root"></div>
    <!-- Buffer polyfill MUST load before any module scripts for Particle SDK -->
    <script>
      // Pre-initialize globals that SDKs expect
      window.global = window;
      window.process = window.process || { env: {} };
      // Buffer will be properly set by the polyfills module, but we need a placeholder
      // to prevent "Buffer is not defined" during chunk loading
      if (typeof window.Buffer === 'undefined') {
        window.Buffer = {
          isBuffer: function() { return false; },
          from: function(data, encoding) {
            if (typeof data === 'string') {
              return new TextEncoder().encode(data);
            }
            return new Uint8Array(data);
          },
          alloc: function(size) { return new Uint8Array(size); },
          allocUnsafe: function(size) { return new Uint8Array(size); },
          concat: function(list) {
            var totalLength = list.reduce(function(acc, arr) { return acc + arr.length; }, 0);
            var result = new Uint8Array(totalLength);
            var offset = 0;
            for (var i = 0; i < list.length; i++) {
              result.set(list[i], offset);
              offset += list[i].length;
            }
            return result;
          }
        };
      }
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
